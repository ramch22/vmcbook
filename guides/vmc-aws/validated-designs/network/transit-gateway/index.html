<!DOCTYPE html>
<html>

<head>
  <title>VMware Cloud Knowledge</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="VMware Cloud articles and guides.">
  <meta name="generator" content="Hugo 0.60.0-DEV" />
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" href="https://dspinhirne.github.io/vmcbook/main.css">
  <script type="text/javascript" src="https://dspinhirne.github.io/vmcbook/main.js"></script>
</head>

  <body>
    
    <header class="main-header">
      <div>
        <a href="https://cloud.vmware.com"><img src="https://dspinhirne.github.io/vmcbook/images/vm.svg"></a>
      </div>
      <div><a href="https://dspinhirne.github.io/vmcbook/">VMware Cloud Knowledge</a></div>
      <div>
        <a href="https://github.com/dspinhirne/vmcbook" class="github-link"><img src="https://dspinhirne.github.io/vmcbook/images/github.svg"><span>Star</span></a>
      </div>
    </header>

    <article class="main-article">
      <nav class="left-nav">
        <ul class="top-level"><li >
        <span onclick="leftNavClick(this)">Getting Started</span><ul class="sub-level">
        <li><a href="/vmcbook/guides/getting-started/" >Index</a></li>
        <li ><a href="/vmcbook/guides/getting-started/introduction/" >Introduction</a></li><li >
        <span onclick="leftNavClick(this)">HowTo</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/getting-started/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/getting-started/howto/activate-services/" >Activate Services</a></li><li ><a href="/vmcbook/guides/getting-started/howto/billing/" >Billing</a></li><li ><a href="/vmcbook/guides/getting-started/howto/manage-users/" >Manage Users</a></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">HCX</span><ul class="sub-level">
        <li><a href="/vmcbook/guides/hcx/" >Index</a></li>
        <li >
        <span onclick="leftNavClick(this)">A Technical Overview</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/hcx/a-technical-overview/" >Index</a></li>
        <li ><a href="/vmcbook/guides/hcx/a-technical-overview/introduction/" >Introduction</a></li><li ><a href="/vmcbook/guides/hcx/a-technical-overview/planning/" >Planning</a></li><li ><a href="/vmcbook/guides/hcx/a-technical-overview/preparation/" >Preparation</a></li><li ><a href="/vmcbook/guides/hcx/a-technical-overview/testing/" >Testing</a></li><li ><a href="/vmcbook/guides/hcx/a-technical-overview/migration/" >Migration</a></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">HowTo</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/hcx/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/hcx/howto/activate/" >Activate</a></li><li ><a href="/vmcbook/guides/hcx/howto/install/" >Install</a></li><li ><a href="/vmcbook/guides/hcx/howto/network-extension/" >Network Extension</a></li><li ><a href="/vmcbook/guides/hcx/howto/workload-migration/" >Workload Migration</a></li>
      </ul></li>
      </ul></li><li class="open parent">
        <span onclick="leftNavClick(this)">VMware Cloud on AWS</span><ul class="sub-level">
        <li><a href="/vmcbook/guides/vmc-aws/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/a-technical-overview/" >A Technical Overview</a></li><li >
        <span onclick="leftNavClick(this)">On-Boarding</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/on-boarding/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/on-boarding/introduction/" >Introduction</a></li><li ><a href="/vmcbook/guides/vmc-aws/on-boarding/requirements/" >Requirements</a></li><li >
        <span onclick="leftNavClick(this)">HowTo</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/on-boarding/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/on-boarding/howto/term-subscription/" >Term Subscription</a></li><li ><a href="/vmcbook/guides/vmc-aws/on-boarding/howto/sddc/" >SDDC</a></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">Networking</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/networking/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/networking/sddc-architecture/" >SDDC Architecture</a></li><li >
        <span onclick="leftNavClick(this)">IPSec VPN</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/concepts/" >Concepts</a></li><li >
        <span onclick="leftNavClick(this)">Howto</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/configure/" >Configure</a></li><li ><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/troubleshoot/" >Troubleshoot</a></li><li ><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/sample-configs/" >Sample Configs</a></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">Direct Connect</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/networking/direct-connect/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/networking/direct-connect/concepts/" >Concepts</a></li><li >
        <span onclick="leftNavClick(this)">HowTo</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/networking/direct-connect/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/networking/direct-connect/howto/configure/" >Configure</a></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">HowTo</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/networking/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/networking/howto/network-segments/" >Network Segments</a></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">Network Security</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/network-security/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/network-security/concepts/" >Concepts</a></li><li >
        <span onclick="leftNavClick(this)">HowTo</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/network-security/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/network-security/howto/services/" >Services</a></li><li ><a href="/vmcbook/guides/vmc-aws/network-security/howto/groups/" >Groups</a></li><li ><a href="/vmcbook/guides/vmc-aws/network-security/howto/gateway-firewall/" >Gateway Firewall</a></li><li ><a href="/vmcbook/guides/vmc-aws/network-security/howto/dfw/" >DFW</a></li><li ><a href="/vmcbook/guides/vmc-aws/network-security/howto/nat/" >NAT</a></li>
      </ul></li>
      </ul></li><li class="open parent">
        <span onclick="leftNavClick(this)">Validated Designs</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/validated-designs/" >Index</a></li>
        <li class="open parent">
        <span onclick="leftNavClick(this)">Network</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/validated-designs/network/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/validated-designs/network/hub-and-spoke-designs/" >Hub-and-Spoke Designs</a></li><li class="open parent"><a href="/vmcbook/guides/vmc-aws/validated-designs/network/transit-gateway/" class="active">Transit Gateway</a></li>
      </ul></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">Site</span><ul class="sub-level">
        <li><a href="/vmcbook/site/" >Index</a></li>
        <li ><a href="/vmcbook/site/authors/" >Authors</a></li><li ><a href="/vmcbook/site/authoring-guide/" >Authoring Guide</a></li><li ><a href="/vmcbook/site/information/" >Information</a></li><li ><a href="/vmcbook/site/links/" >Links</a></li><li ><a href="/vmcbook/site/editor/" >Markdown Editor</a></li><li ><a href="/vmcbook/site/resources/" >Resources</a></li>
      </ul></li></ul>
      </nav>

      <main class="main-content">  <div class="TableOfContents">
    <h1>Page Contents</h1>
    <nav id="TableOfContents">
<ul>
<li><a href="#solution-overview">Solution Overview</a></li>
<li><a href="#integration-using-ipsec-vpn">Integration Using IPSec VPN</a></li>
</ul>
</nav>
  </div>

  
  <article class="content with-toc">
    <header class="content-header">
      <strong class="heading">VMware Cloud on AWS</strong><strong class="sub-heading">Validated Designs:Transit Gateway</strong></header>

    

<h1 id="solution-overview">Solution Overview</h1>

<p>It is a common practice to deploy an SDDC as a spoke network within a Transit Gateway based <a href="https://dspinhirne.github.io/vmcbook/guides/vmc-aws/validated-designs/network/hub-and-spoke-designs/">hub-and-spoke</a> design. This document will discuss the currently supported solutions for this type of integration.</p>

<h1 id="integration-using-ipsec-vpn">Integration Using IPSec VPN</h1>

<p>Connecting an SDDC to a Transit Gateway with IPSec VPN utilizes one or more VPN attachments within the Transit Gateway. Underlying each attachment is a dedicated VGW, which is similar in form and function to the VGW used within an IPSec VPN connection to a VPC.</p>

<p>As a standard practice, it is recommended to deploy VPN attachments with multiple VPN connections for redundancy and performance reasons. Configurations with multiple VPN connections to the same remote endpoint will utilize route-based VPN and <a href="https://en.wikipedia.org/wiki/Equal-cost_multi-path_routing">ECMP</a> routing to load balance between the VPNs.</p>

<figure   ><img src="https://dspinhirne.github.io/vmcbook/guides/vmc-aws/validated-designs/network/transit-gateway/images/tgw-ipsec-integration.png" alt="https://dspinhirne.github.io/vmcbook/guides/vmc-aws/validated-designs/network/transit-gateway/images/tgw-ipsec-integration.png" /></figure>


<p>There are several notable considerations with this design, including:</p>

<ul>
<li><p><strong>Overhead</strong> - IPSec introduces additional protocol overhead which results in lower <a href="https://en.wikipedia.org/wiki/Maximum_transmission_unit">MTU</a> for end-user traffic. Generally, most operating systems make use of <a href="https://en.wikipedia.org/wiki/Path_MTU_Discovery">path MTU discovery</a> for detecting lower in-path MTU values but this may not always be the case. Operating systems or applications which are not able to detect MTU may result in IP fragmentation, packet loss, or lower performance through the VPN.</p></li>

<li><p><strong>Performance</strong> - IPSec VPN introduces additional processing overhead which results in lower throughput than would otherwise be expected. Although most implementations of IPSec VPN describe performance in terms of bits-per-second, the real limiting factor tends to be packets-per-second (PPS). For instance, a vendor may list a throughput limit of 1Gbps for their device, but what they are actually saying is that you can expect to get 1Gbps (aggregate of ingress/egress) using &ldquo;large&rdquo; packets (1300-byte or so). Since the real limiting factor of the device is the number of packets it can process per second, this 1Gbps number is only valid if you are consistently sending &ldquo;large&rdquo; packets through the VPN. This throughput number will significantly decrease if your average packet size is anything other than &ldquo;large&rdquo;. Please refer to the published <a href="https://docs.aws.amazon.com/vpc/latest/userguide/amazon-vpc-limits.html">limits</a> for Transit Gateway.</p></li>

<li><p><strong>Balance</strong> - ECMP typically utilizes a 5-tuple hashing function (protocol, src/dst ip, src/dst port) for binding a given connection to a particular tunnel (and in some cases to a particular CPU core within the device). Note that nowhere in this hashing function is network load considered. This means that it is unreasonable to expect a perfect load balance between tunnels/cores, and that it is quite possible for 1 tunnel/core to be completely maxed out while other tunnels/cores are simultaneously under utilized. This situation will result in some users experiencing degraded network connectivity which will appear to be random to the casual observer. For this reason, it becomes extremely important to monitor the performance of each tunnel in an ECMP configuration in order to help diagnose this type of situation.</p></li>
</ul>
    
    <footer class="content-footer"><div>Written by<a href='https://dspinhirne.github.io/vmcbook/site/authors/#dustin-spinhirne'>Dustin Spinhirne</a></div><div>
          Originally publishedTuesday, Oct 1, 2019.</div></footer>

  </article></main>
    </article>
    
  </body>
</html>

<!DOCTYPE html>
<html>

<head>
  <title>VMware Cloud Knowledge</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="VMware Cloud articles and guides.">
  <meta name="generator" content="Hugo 0.60.0-DEV" />
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" href="https://dspinhirne.github.io/vmcbook/main.css">
  <script type="text/javascript" src="https://dspinhirne.github.io/vmcbook/main.js"></script>
</head>

  <body>
    
    <header class="main-header">
      <div>
        <a href="https://cloud.vmware.com"><img src="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/resources/images/vm.svg"></a>
      </div>
      <div><a href="https://dspinhirne.github.io/vmcbook/">VMware Cloud Knowledge</a></div>
      <div>
        <a href="https://github.com/dspinhirne/vmcbook" class="github-link"><img src="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/resources/images/github.svg"><span>Star</span></a>
      </div>
    </header>

    <article class="main-article">
      <nav class="left-nav">
        <ul class="top-level"><li >
        <span onclick="leftNavClick(this)">Getting Started</span><ul class="sub-level">
        <li><a href="/vmcbook/guides/getting-started/" >Index</a></li>
        <li ><a href="/vmcbook/guides/getting-started/introduction/" >Introduction</a></li><li >
        <span onclick="leftNavClick(this)">HowTo</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/getting-started/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/getting-started/howto/activate-services/" >Activate Services</a></li><li ><a href="/vmcbook/guides/getting-started/howto/billing/" >Billing</a></li><li ><a href="/vmcbook/guides/getting-started/howto/manage-users/" >Manage Users</a></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">HCX</span><ul class="sub-level">
        <li><a href="/vmcbook/guides/hcx/" >Index</a></li>
        <li >
        <span onclick="leftNavClick(this)">A Technical Overview</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/hcx/a-technical-overview/" >Index</a></li>
        <li ><a href="/vmcbook/guides/hcx/a-technical-overview/introduction/" >Introduction</a></li><li ><a href="/vmcbook/guides/hcx/a-technical-overview/planning/" >Planning</a></li><li ><a href="/vmcbook/guides/hcx/a-technical-overview/preparation/" >Preparation</a></li><li ><a href="/vmcbook/guides/hcx/a-technical-overview/testing/" >Testing</a></li><li ><a href="/vmcbook/guides/hcx/a-technical-overview/migration/" >Migration</a></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">HowTo</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/hcx/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/hcx/howto/activate/" >Activate</a></li><li ><a href="/vmcbook/guides/hcx/howto/install/" >Install</a></li><li ><a href="/vmcbook/guides/hcx/howto/network-extension/" >Network Extension</a></li><li ><a href="/vmcbook/guides/hcx/howto/workload-migration/" >Workload Migration</a></li>
      </ul></li>
      </ul></li><li class="open parent">
        <span onclick="leftNavClick(this)">VMware Cloud on AWS</span><ul class="sub-level">
        <li><a href="/vmcbook/guides/vmc-aws/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/a-technical-overview/" >A Technical Overview</a></li><li >
        <span onclick="leftNavClick(this)">On-Boarding</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/on-boarding/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/on-boarding/introduction/" >Introduction</a></li><li ><a href="/vmcbook/guides/vmc-aws/on-boarding/requirements/" >Requirements</a></li><li >
        <span onclick="leftNavClick(this)">HowTo</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/on-boarding/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/on-boarding/howto/term-subscription/" >Term Subscription</a></li><li ><a href="/vmcbook/guides/vmc-aws/on-boarding/howto/sddc/" >SDDC</a></li>
      </ul></li>
      </ul></li><li class="open parent">
        <span onclick="leftNavClick(this)">Networking</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/networking/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/networking/sddc-architecture/" >SDDC Architecture</a></li><li >
        <span onclick="leftNavClick(this)">IPSec VPN</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/concepts/" >Concepts</a></li><li >
        <span onclick="leftNavClick(this)">Howto</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/configure/" >Configure</a></li><li ><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/troubleshoot/" >Troubleshoot</a></li><li ><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/sample-configs/" >Sample Configs</a></li>
      </ul></li>
      </ul></li><li class="open parent">
        <span onclick="leftNavClick(this)">Direct Connect</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/networking/direct-connect/" >Index</a></li>
        <li class="open parent"><a href="/vmcbook/guides/vmc-aws/networking/direct-connect/concepts/" class="active">Concepts</a></li><li >
        <span onclick="leftNavClick(this)">HowTo</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/networking/direct-connect/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/networking/direct-connect/howto/configure/" >Configure</a></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">HowTo</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/networking/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/networking/howto/network-segments/" >Network Segments</a></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">Network Security</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/network-security/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/network-security/concepts/" >Concepts</a></li><li >
        <span onclick="leftNavClick(this)">HowTo</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/network-security/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/network-security/howto/services/" >Services</a></li><li ><a href="/vmcbook/guides/vmc-aws/network-security/howto/groups/" >Groups</a></li><li ><a href="/vmcbook/guides/vmc-aws/network-security/howto/gateway-firewall/" >Gateway Firewall</a></li><li ><a href="/vmcbook/guides/vmc-aws/network-security/howto/dfw/" >DFW</a></li><li ><a href="/vmcbook/guides/vmc-aws/network-security/howto/nat/" >NAT</a></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">Validated Designs</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/validated-designs/" >Index</a></li>
        <li >
        <span onclick="leftNavClick(this)">Network</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/validated-designs/network/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/validated-designs/network/hub-and-spoke-designs/" >Hub-and-Spoke Designs</a></li><li ><a href="/vmcbook/guides/vmc-aws/validated-designs/network/transit-gateway/" >Transit Gateway</a></li>
      </ul></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">Site</span><ul class="sub-level">
        <li><a href="/vmcbook/site/" >Index</a></li>
        <li ><a href="/vmcbook/site/authors/" >Authors</a></li><li ><a href="/vmcbook/site/authoring-guide/" >Authoring Guide</a></li><li ><a href="/vmcbook/site/information/" >Information</a></li><li ><a href="/vmcbook/site/links/" >Links</a></li><li ><a href="/vmcbook/site/editor/" >Markdown Editor</a></li><li ><a href="/vmcbook/site/resources/" >Resources</a></li>
      </ul></li></ul>
      </nav>

      <main class="main-content">  <div class="TableOfContents">
    <h1>Page Contents</h1>
    <nav id="TableOfContents">
<ul>
<li><a href="#technical-overview">Technical Overview</a></li>
<li><a href="#public-vif">Public VIF</a></li>
<li><a href="#private-vif">Private VIF</a></li>
<li><a href="#project-plan">Project Plan</a></li>
</ul>
</nav>
  </div>

  
  <article class="content with-toc">
    <header class="content-header">
      <strong class="heading">VMware Cloud on AWS</strong><strong class="sub-heading">Direct Connect:Concepts</strong></header>

    

<h1 id="technical-overview">Technical Overview</h1>

<p>Under normal circumstances, customers will access their SDDC via the public internet; either directly to VM public IP addresses, or to private addresses via IPSec VPN. Often times, however, customers wish to avoid using their public internet provider for connectivity to the SDDC. For these cases, AWS offers <a href="https://docs.aws.amazon.com/directconnect/latest/UserGuide/Welcome.html">Direct Connect</a>, which provides direct connectivity into an AWS region via private leased lines. With Direct Connect, users will define virtual interfaces (<a href="https://docs.aws.amazon.com/directconnect/latest/UserGuide/WorkingWithVirtualInterfaces.html">VIF</a>) which allow them to connect to public or private resources within that Region. These VIFs come in 2 flavors: Public and Private.</p>

<p>Public VIF enables the Direct Connect to be used for accessing the AWS public network. When Public VIF is used, the Direct Connect will become the preferred path for reaching AWS public IP addresses. This means that if IPSec VPN is being used to access the SDDC, then it will ride over the Direct Connect (assuming the VPN peering is done via the edge public IP).</p>

<p>Private VIF, on the other hand, enables Direct Connect to be used for accessing the private IP address space of a VPC. When a Private VIF is associated to an SDDC, then it becomes possible to access the SDDC directly without the need for IPSec VPN (although you can use IPSec VPN over Private VIF is so desired).</p>

<p>The next sections will explore this in more detail.</p>

<h1 id="public-vif">Public VIF</h1>

<p>Public VIF enables a Direct Connect to be used for accessing the public IP address space of  the AWS network. Let&rsquo;s look into the details of how this is implemented.</p>

<p>Normally, customers will have one or more public internet circuits over which they will receive either default routes, or specific BGP prefixes. These circuits are used to access the public IP address space which AWS advertises to its upstream internet providers. In this example, the on-premises router is receiving a default route to the internet.</p>

<figure   ><img src="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/resources/images/guides/vmc-aws/networking/direct-connect/concepts/dx-public-vif.png" alt="Public VIF" /><figcaption>Public VIF</figcaption></figure>


<p>When Direct Connect is enabled, and a Public VIF created, AWS will begin to announce all of their public IP prefixes, via BGP, over the Direct Connect. In this example, due to the specific routes being advertised by AWS, the customer network will prefer the Direct Connect as its path toward AWS public address space. This effectively means that the Direct Connect will be used when connecting to the public IP addresses allocated to the SDDC; for example, the public interface of the edge or the Elastic IP of vCenter.</p>

<p>One important consideration when using Public VIF is to keep in mind that the on-premises network must also be reachable via its own public IP address space. For larger customers with their own public IP ranges and BGP ASN, they may choose to advertise this address space to AWS over the Direct Connect. Doing so will ensure that routing between the customer on-premises environment and AWS is symmetrical, and rides exclusively over the Direct Connect. However, the average AWS customer either does not have their own BGP ASN and public IP ranges, or does not want to advertise them over the Direct Connect.</p>

<p>For these cases, customers may submit a request to AWS for a public IP. AWS will then allocate an IP from their own public address space which may be used by the customer for their end of the connection. It is important to note that in these cases customers must set up NAT such that all traffic originating from their end ( which uses the Public VIF) is NAT-ted to that public IP. A common mistake is to forget to configure NAT, and in these cases customers will end up routing traffic into the AWS public network which is sourced from their internal private IPs. In this scenario, AWS will drop the traffic, and the end result will be that AWS public address space will be unreachable from the customer environment.</p>

<h1 id="private-vif">Private VIF</h1>

<p>The standard means of accessing the private address space of an SDDC is via IPSec VPN. This VPN creates a secure virtual tunnel directly between the customer on-premises and the SDDC, either over the public internet or atop Direct Connect Public VIF. Direct Connect Private VIF provides an alternative to IPSec VPN by enabling a direct routed path between the customer on-premises network and a VPC within the AWS environment.</p>

<figure   ><img src="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/resources/images/guides/vmc-aws/networking/direct-connect/concepts/dx-private-vif.png" alt="Private VIF" /><figcaption>Private VIF</figcaption></figure>


<p>As mentioned previously, each SDDC resides within a dedicated VPC which is owned by a master VMware account. Because the SDDC resides within a VPC, it is possible to terminate Direct Connect Private VIF directly to that VPC. In order to use Direct Connect with an SDDC, <strong>customers must specifically link the Private VIF to the VMware AWS account used by the SDDC</strong>. This account information is documented within the Network &amp; Security tab of the SDDC within the VMC console.</p>

<p>Once the VIF has been terminated, the SDDC begins advertising routes through the Private VIF via BGP. The customer on-premises router should also be configured to advertise routes (representing the customer private address space) to the SDDC. As a general rule, the best practice is to advertise specific routes into the Direct Connect from the on-premises network instead of advertising a default route.</p>

<p>As seen in <a class="xref" href="#fig-private-vif"></a> above, the edge routers of the SDDC are in-path for Direct Connect. This means that gateway firewalls are enforcing security and that the security policies of the SDDC must be configured to permit connectivity to and from the on-premises environment.</p>

<p>There is one important exception to this rule, however. Due to the fact that the ESXi hosts themselves reside at the base-layer of the infrastructure, two of their interfaces are directly connected to Subnets of the underlying VPC. Specifically, the management and vMotion interfaces. For these interfaces, the path through the Direct Connect will bypass the edge routers of the SDDC. This means that security between the on-premises network and the ESXi hosts must be enforced on the on-premises side of the Direct Connect. Again, this scenario only applies to Direct Connect Private VIF and does not apply to users of IPSec VPN.</p>

<h1 id="project-plan">Project Plan</h1>

<p>The following project plan may be used when configuring an SDDC with Direct Connect.</p>

<figure  class="full-width" ><table>
<thead>
<tr>
<th>Task</th>
<th>Required</th>
<th>References</th>
<th>Comments</th>
</tr>
</thead>

<tbody>
<tr>
<td>Identify Direct Connect circuit(s) to be connect to the SDDC.</td>
<td>yes</td>
<td></td>
<td>These will exist in the customer AWS account.</td>
</tr>

<tr>
<td>Identify BGP peering address space for the Direct Connect Private VIF(s).</td>
<td>yes</td>
<td></td>
<td>The address range for the private VIF. Do not auto-assign these. Typically IPv4 link-local space is used for this. Consult the user guide to ensure that you do not utilize link-local space which is used internally within the SDDC.</td>
</tr>

<tr>
<td>Identify BGP ASNs to be used for Direct Connect Private VIF(s).</td>
<td>yes</td>
<td></td>
<td>BGP private ASN range 64512 - 655334. Ensure that this does not conflict with existing peers on your end of the VPN.</td>
</tr>

<tr>
<td>Identify on-prem routes to be advertised to the SDDC.</td>
<td>yes</td>
<td></td>
<td>Be aware that if you advertise default route to the SDDC that you will force all internet traffic through the direct connect.</td>
</tr>

<tr>
<td>Create or adjust prefix-lists or other filters for BGP.</td>
<td>no</td>
<td></td>
<td>Although route filters are highly recommended with any BGP setup, this step depends on your existing setup.</td>
</tr>

<tr>
<td>Create a private VIF on the direct connect for the SDDC.</td>
<td>yes</td>
<td><a href="https://dspinhirne.github.io/vmcbook/guides/vmc-aws/networking/direct-connect/howto/configure/#create-a-private-vif">https://dspinhirne.github.io/vmcbook/guides/vmc-aws/networking/direct-connect/howto/configure/#create-a-private-vif</a></td>
<td>You must delegate this VIF to the VMware AWS account which is found under the direct connect dashboard of your SDDC.</td>
</tr>

<tr>
<td>Attach the direct connect within the SDDC</td>
<td>yes</td>
<td><a href="https://dspinhirne.github.io/vmcbook/guides/vmc-aws/networking/direct-connect/howto/configure/#attach-a-private-vif">https://dspinhirne.github.io/vmcbook/guides/vmc-aws/networking/direct-connect/howto/configure/#attach-a-private-vif</a></td>
<td>Performed from the direct connect dashboard of your SDDC. May take several minutes to complete.</td>
</tr>
</tbody>
</table><div class="tab"><a href="#" onclick="exportCSV(this)" >Export Table</a></div></figure>

    
    <footer class="content-footer"><div>Written by <a href='https://dspinhirne.github.io/vmcbook/site/authors/#dustin-spinhirne'>Dustin Spinhirne</a></div><div>
          Originally publishedSunday, Sep 16, 2018.Updated onTuesday, Oct 1, 2019.</div></footer>

  </article></main>
    </article>
    
  </body>
</html>

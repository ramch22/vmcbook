<!DOCTYPE html>
<html>

<head>
  <title>VMware Cloud Knowledge</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="VMware Cloud articles and guides.">
  <meta name="generator" content="Hugo 0.62.2" />
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" href="https://dspinhirne.github.io/vmcbook/main.css">
  <script type="text/javascript" src="https://dspinhirne.github.io/vmcbook/main.js"></script>
</head>

  <body>
    
    <header class="main-header">
      <div>
        <a href="https://cloud.vmware.com"><img src="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/resources/images/vm.svg"></a>
      </div>
      <div><a href="https://dspinhirne.github.io/vmcbook/">VMware Cloud Knowledge</a></div>
      <div>
        <a href="https://github.com/dspinhirne/vmcbook" class="github-link"><img src="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/resources/images/github.svg"><span>Star</span></a>
      </div>
    </header>

    <article class="main-article">
      <nav class="left-nav">
        <ul class="top-level"><li >
        <span onclick="leftNavClick(this)">Getting Started</span><ul>
        <li><a href="/vmcbook/guides/getting-started/" >Index</a></li>
        <li ><a href="/vmcbook/guides/getting-started/introduction/" >Introduction</a></li><li >
        <span onclick="leftNavClick(this)">HowTo</span><ul>
        <li><a href="/vmcbook/guides/getting-started/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/getting-started/howto/activate-services/" >Activate Services</a></li><li ><a href="/vmcbook/guides/getting-started/howto/billing/" >Billing</a></li><li ><a href="/vmcbook/guides/getting-started/howto/manage-users/" >Manage Users</a></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">HCX</span><ul>
        <li><a href="/vmcbook/guides/hcx/" >Index</a></li>
        <li >
        <span onclick="leftNavClick(this)">A Technical Overview</span><ul>
        <li><a href="/vmcbook/guides/hcx/a-technical-overview/" >Index</a></li>
        <li ><a href="/vmcbook/guides/hcx/a-technical-overview/introduction/" >Introduction</a></li><li ><a href="/vmcbook/guides/hcx/a-technical-overview/planning/" >Planning</a></li><li ><a href="/vmcbook/guides/hcx/a-technical-overview/preparation/" >Preparation</a></li><li ><a href="/vmcbook/guides/hcx/a-technical-overview/testing/" >Testing</a></li><li ><a href="/vmcbook/guides/hcx/a-technical-overview/migration/" >Migration</a></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">HowTo</span><ul>
        <li><a href="/vmcbook/guides/hcx/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/hcx/howto/activate/" >Activate</a></li><li ><a href="/vmcbook/guides/hcx/howto/install/" >Install</a></li><li ><a href="/vmcbook/guides/hcx/howto/network-extension/" >Network Extension</a></li><li ><a href="/vmcbook/guides/hcx/howto/workload-migration/" >Workload Migration</a></li>
      </ul></li>
      </ul></li><li class="open parent">
        <span onclick="leftNavClick(this)">VMware Cloud on AWS</span><ul>
        <li><a href="/vmcbook/guides/vmc-aws/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/a-technical-overview/" >A Technical Overview</a></li><li >
        <span onclick="leftNavClick(this)">On-Boarding</span><ul>
        <li><a href="/vmcbook/guides/vmc-aws/on-boarding/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/on-boarding/introduction/" >Introduction</a></li><li ><a href="/vmcbook/guides/vmc-aws/on-boarding/requirements/" >Requirements</a></li><li >
        <span onclick="leftNavClick(this)">HowTo</span><ul>
        <li><a href="/vmcbook/guides/vmc-aws/on-boarding/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/on-boarding/howto/term-subscription/" >Term Subscription</a></li><li ><a href="/vmcbook/guides/vmc-aws/on-boarding/howto/sddc/" >SDDC</a></li>
      </ul></li>
      </ul></li><li class="open parent">
        <span onclick="leftNavClick(this)">Networking</span><ul>
        <li><a href="/vmcbook/guides/vmc-aws/networking/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/networking/sddc-architecture/" >SDDC Architecture</a></li><li class="open parent">
        <span onclick="leftNavClick(this)">IPSec VPN</span><ul>
        <li><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/" >Index</a></li>
        <li class="open parent"><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/concepts/" class="active">Concepts</a></li><li >
        <span onclick="leftNavClick(this)">HowTo</span><ul>
        <li><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/configure/" >Configure</a></li><li ><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/troubleshoot/" >Troubleshoot</a></li><li ><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/sample-configs/" >Sample Configs</a></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">Direct Connect</span><ul>
        <li><a href="/vmcbook/guides/vmc-aws/networking/direct-connect/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/networking/direct-connect/concepts/" >Concepts</a></li><li >
        <span onclick="leftNavClick(this)">Index</span><ul>
        <li><a href="/vmcbook/guides/vmc-aws/networking/direct-connect/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/networking/direct-connect/howto/configure/" >Configure</a></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">HowTo</span><ul>
        <li><a href="/vmcbook/guides/vmc-aws/networking/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/networking/howto/network-segments/" >Network Segments</a></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">Network Security</span><ul>
        <li><a href="/vmcbook/guides/vmc-aws/network-security/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/network-security/concepts/" >Concepts</a></li><li >
        <span onclick="leftNavClick(this)">HowTo</span><ul>
        <li><a href="/vmcbook/guides/vmc-aws/network-security/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/network-security/howto/services/" >Services</a></li><li ><a href="/vmcbook/guides/vmc-aws/network-security/howto/groups/" >Groups</a></li><li ><a href="/vmcbook/guides/vmc-aws/network-security/howto/gateway-firewall/" >Gateway Firewall</a></li><li ><a href="/vmcbook/guides/vmc-aws/network-security/howto/dfw/" >DFW</a></li><li ><a href="/vmcbook/guides/vmc-aws/network-security/howto/nat/" >NAT</a></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">Validated Designs</span><ul>
        <li><a href="/vmcbook/guides/vmc-aws/validated-designs/" >Index</a></li>
        <li >
        <span onclick="leftNavClick(this)">Network</span><ul>
        <li><a href="/vmcbook/guides/vmc-aws/validated-designs/network/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/validated-designs/network/hub-and-spoke-designs/" >Hub-and-Spoke Designs</a></li><li ><a href="/vmcbook/guides/vmc-aws/validated-designs/network/transit-gateway/" >Transit Gateway</a></li>
      </ul></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">Site</span><ul>
        <li><a href="/vmcbook/site/" >Index</a></li>
        <li ><a href="/vmcbook/site/authors/" >Authors</a></li><li ><a href="/vmcbook/site/authoring-guide/" >Authoring Guide</a></li><li ><a href="/vmcbook/site/information/" >Information</a></li><li ><a href="/vmcbook/site/links/" >Links</a></li><li ><a href="/vmcbook/site/editor/" >Markdown Editor</a></li><li ><a href="/vmcbook/site/resources/" >Resources</a></li><li ><a href="/vmcbook/site/color-scheme/" >Color Scheme</a></li>
      </ul></li></ul>
      </nav>

      <main class="main-content">  <div class="TableOfContents">
    <h1>Page Contents</h1>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#supported-vpn-types">Supported VPN Types</a>
      <ul>
        <li><a href="#policy-based-vpn">Policy-Based VPN</a></li>
        <li><a href="#route-based-vpn">Route-Based VPN</a></li>
      </ul>
    </li>
    <li><a href="#project-plan">Project Plan</a></li>
  </ul>
</nav>
  </div>

  
  <article class="content with-toc">
    <header class="content-header">
      <h1>VMware Cloud on AWS</h1><h2>IPSec VPN: Concepts</h2></header>

    <h2 id="supported-vpn-types">Supported VPN Types</h2>
<p>Each SDDC supports the termination of both policy-based and route-based VPNs to the tier-0 edge gateway. Although the choice of which type of VPN to implement is ultimately a matter of preference, in general, the recommendation is to use route-based VPN whenever possible. The reasons for this recommendation will be discussed in the sections below.</p>
<h3 id="policy-based-vpn">Policy-Based VPN</h3>
<p>Policy-based VPN relies on defining &ldquo;interesting&rdquo; traffic as part of a policy for determining which traffic should be sent through a VPN. This policy is then applied to an interface (typically an uplink port) of the VPN endpoint, and traffic destined for the VPN is then forced through this interface. In the case of the SDDC, this policy is applied to the &ldquo;internet&rdquo; uplink of the tier-0 edge router.</p>
<p>As part of its standard configuration, the SDDC is configured with a default route which points to its upstream Internet Gateway. This means that all traffic which is non-local to the SDDC will be sent out through the &ldquo;internet&rdquo; uplink and will be matched against any IPSec VPN policies which are applied. If the traffic matches a policy, then it is encapsulated and sent through a VPN. Otherwise it is routed normally to the IGW. The notable exception to this rule is in cases where the SDDC knows specific routes through alternative uplinks. The first example of this will be with the cross-linked VPC. Traffic destined for this VPC will not cross the internet uplink and will not be matched against any policies. Similarly, if Direct Connect is attached to the SDDC, then traffic destined to any networks learned via the Direct Connect will also not pass through the internet uplink.</p>
<figure   ><img src="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/resources/images/guides/vmc-aws/networking/ipsec-vpn/concepts/policy-based-vpn.png" alt="Policy-Based VPN" /><figcaption>Policy-Based VPN</figcaption></figure>

<p>This highlights an important caveat to policy-based VPN; if any routes are learned via alternative uplinks (i.e. Direct Connect, cross-linked VPC, other route-based VPNs) which encompass networks configured on the policy-based VPN, then the traffic will not pass through the internet uplink and will not hit the policy. Effectively, this means that you must carefully plan what routes you advertise to the SDDC if you intend to use policy-based VPN in conjunction with Direct Connect or route-based VPN.</p>
<h3 id="route-based-vpn">Route-Based VPN</h3>
<p>Route-based VPN works on the notion that a Virtual Tunnel Interface (VTI) exists between the two VPN peers. This VTI is protected by IPSec encryption, but is otherwise treated as a normal uplink, over which BGP peering is established, and over which traffic may be routed.</p>
<figure   ><img src="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/resources/images/guides/vmc-aws/networking/ipsec-vpn/concepts/route-based-vpn.png" alt="Route-Based VPN" /><figcaption>Route-Based VPN</figcaption></figure>

<p>Within the SDDC, the VTI interfaces are created on the tier-0 edge as a type of uplink over which a BGP session is established. Routes learned over these BGP sessions populate the routing table and add an extra layer of functionality to the IPSec VPN. For example, with route-based VPN it becomes possible to enable redundant tunnels by taking advantage of BGP to handle the fail-over between tunnels, and it becomes possible to more granularity control routing between all uplinks of the edge.</p>
<p>The added flexibility and configurability of route-based VPN is one of the main reasons for it being the preferred solution for IPSec VPN configurations.</p>
<h2 id="project-plan">Project Plan</h2>
<p>The following project plans may be used when configuring an SDDC with IPSec VPN. Plans vary slightly based on the type of VPN to be deployed.</p>
<p>Applicable to all VPN types.
<figure  class="full-width" ><table>
<thead>
<tr>
<th>Task</th>
<th>Required</th>
<th>References</th>
<th>Comments</th>
</tr>
</thead>
<tbody>
<tr>
<td>Identify VPN type to create</td>
<td>yes</td>
<td></td>
<td>Options are policy-based or route-based. Follow respective project plan below.</td>
</tr>
<tr>
<td>Identify VPN endpoint(s) to connect to SDDC edge.</td>
<td>yes</td>
<td></td>
<td>The public IP(s) of your end of the VPN.</td>
</tr>
</tbody>
</table><div class="tab"><a href="#" onclick="exportCSV(this)" >Export Table</a></div></figure>
</p>
<p>Applicable only to policy-based VPN.
<figure  class="full-width" ><table>
<thead>
<tr>
<th>Task</th>
<th>Required</th>
<th>References</th>
<th>Comments</th>
</tr>
</thead>
<tbody>
<tr>
<td>Identify remote networks to include within VPN policy.</td>
<td>yes</td>
<td></td>
<td>These are the networks which you wish to be reachable by the SDDC.</td>
</tr>
<tr>
<td>Identify SDDC networks to include within VPN policy.</td>
<td>yes</td>
<td></td>
<td>These are the SDDC networks which you wish to be reachable from the remote network.</td>
</tr>
<tr>
<td>Create the policy-based VPN.</td>
<td>yes</td>
<td><a href="https://dspinhirne.github.io/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/configure/#policy-based-vpn">https://dspinhirne.github.io/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/configure/#policy-based-vpn</a></td>
<td></td>
</tr>
</tbody>
</table><div class="tab"><a href="#" onclick="exportCSV(this)" >Export Table</a></div></figure>
</p>
<p>Applicable only to route-based VPN.
<figure  class="full-width" ><table>
<thead>
<tr>
<th>Task</th>
<th>Required</th>
<th>References</th>
<th>Comments</th>
</tr>
</thead>
<tbody>
<tr>
<td>Identify BGP peering address space for the VTI(s).</td>
<td>yes</td>
<td></td>
<td>The address range for the point-to-point virtual link. Typically IPv4 link-local space is used for this. Consult the user guide to ensure that you do not utilize link-local space which is used internally within the SDDC.</td>
</tr>
<tr>
<td>Identify BGP ASNs to be used for SDDC.</td>
<td>yes</td>
<td></td>
<td>BGP private ASN range 64512 - 655334. Ensure that this does not conflict with existing peers on your end of the VPN.</td>
</tr>
<tr>
<td>Identify on-premises routes to be advertised to the SDDC.</td>
<td>yes</td>
<td></td>
<td>Be aware that if you advertise default route to the SDDC that you will force all internet traffic through the VPN.</td>
</tr>
<tr>
<td>Create or adjust prefix-lists or other filters for BGP.</td>
<td>no</td>
<td></td>
<td>Although route filters are highly recommended with any BGP setup, this step depends on your existing setup.</td>
</tr>
<tr>
<td>Create the route-based VPN.</td>
<td>yes</td>
<td><a href="https://dspinhirne.github.io/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/configure/#route-based-vpn">https://dspinhirne.github.io/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/configure/#route-based-vpn</a></td>
<td></td>
</tr>
</tbody>
</table><div class="tab"><a href="#" onclick="exportCSV(this)" >Export Table</a></div></figure>
</p>
    
    <footer class="content-footer"><div>Written by <!-- raw HTML omitted -->Dustin Spinhirne<!-- raw HTML omitted --></div><div>
          Originally published Saturday, Dec 1, 2018.
          Updated on Thursday, Jan 16, 2020.</div></footer>

  </article></main>
    </article>
    
  </body>
</html>

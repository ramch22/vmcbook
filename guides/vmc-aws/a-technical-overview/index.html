<!DOCTYPE html>
<html>

<head>
  <title>VMware Cloud Knowledge</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="VMware Cloud articles and guides.">
  <meta name="generator" content="Hugo 0.60.0-DEV" />
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" href="https://dspinhirne.github.io/vmcbook/main.css">
  <script type="text/javascript" src="https://dspinhirne.github.io/vmcbook/main.js"></script>
</head>

  <body>
    
    <header class="main-header">
      <div>
        <a href="https://cloud.vmware.com"><img src="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/resources/images/vm.svg"></a>
      </div>
      <div><a href="https://dspinhirne.github.io/vmcbook/">VMware Cloud Knowledge</a></div>
      <div>
        <a href="https://github.com/dspinhirne/vmcbook" class="github-link"><img src="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/resources/images/github.svg"><span>Star</span></a>
      </div>
    </header>

    <article class="main-article">
      <nav class="left-nav">
        <ul class="top-level"><li >
        <span onclick="leftNavClick(this)">Getting Started</span><ul class="sub-level">
        <li><a href="/vmcbook/guides/getting-started/" >Index</a></li>
        <li ><a href="/vmcbook/guides/getting-started/introduction/" >Introduction</a></li><li >
        <span onclick="leftNavClick(this)">HowTo</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/getting-started/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/getting-started/howto/activate-services/" >Activate Services</a></li><li ><a href="/vmcbook/guides/getting-started/howto/billing/" >Billing</a></li><li ><a href="/vmcbook/guides/getting-started/howto/manage-users/" >Manage Users</a></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">HCX</span><ul class="sub-level">
        <li><a href="/vmcbook/guides/hcx/" >Index</a></li>
        <li >
        <span onclick="leftNavClick(this)">A Technical Overview</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/hcx/a-technical-overview/" >Index</a></li>
        <li ><a href="/vmcbook/guides/hcx/a-technical-overview/introduction/" >Introduction</a></li><li ><a href="/vmcbook/guides/hcx/a-technical-overview/planning/" >Planning</a></li><li ><a href="/vmcbook/guides/hcx/a-technical-overview/preparation/" >Preparation</a></li><li ><a href="/vmcbook/guides/hcx/a-technical-overview/testing/" >Testing</a></li><li ><a href="/vmcbook/guides/hcx/a-technical-overview/migration/" >Migration</a></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">HowTo</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/hcx/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/hcx/howto/activate/" >Activate</a></li><li ><a href="/vmcbook/guides/hcx/howto/install/" >Install</a></li><li ><a href="/vmcbook/guides/hcx/howto/network-extension/" >Network Extension</a></li><li ><a href="/vmcbook/guides/hcx/howto/workload-migration/" >Workload Migration</a></li>
      </ul></li>
      </ul></li><li class="open parent">
        <span onclick="leftNavClick(this)">VMware Cloud on AWS</span><ul class="sub-level">
        <li><a href="/vmcbook/guides/vmc-aws/" >Index</a></li>
        <li class="open parent"><a href="/vmcbook/guides/vmc-aws/a-technical-overview/" class="active">A Technical Overview</a></li><li >
        <span onclick="leftNavClick(this)">On-Boarding</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/on-boarding/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/on-boarding/introduction/" >Introduction</a></li><li ><a href="/vmcbook/guides/vmc-aws/on-boarding/requirements/" >Requirements</a></li><li >
        <span onclick="leftNavClick(this)">HowTo</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/on-boarding/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/on-boarding/howto/term-subscription/" >Term Subscription</a></li><li ><a href="/vmcbook/guides/vmc-aws/on-boarding/howto/sddc/" >SDDC</a></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">Networking</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/networking/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/networking/sddc-architecture/" >SDDC Architecture</a></li><li >
        <span onclick="leftNavClick(this)">IPSec VPN</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/concepts/" >Concepts</a></li><li >
        <span onclick="leftNavClick(this)">Howto</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/configure/" >Configure</a></li><li ><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/troubleshoot/" >Troubleshoot</a></li><li ><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/sample-configs/" >Sample Configs</a></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">Direct Connect</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/networking/direct-connect/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/networking/direct-connect/concepts/" >Concepts</a></li><li >
        <span onclick="leftNavClick(this)">HowTo</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/networking/direct-connect/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/networking/direct-connect/howto/configure/" >Configure</a></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">HowTo</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/networking/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/networking/howto/network-segments/" >Network Segments</a></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">Network Security</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/network-security/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/network-security/concepts/" >Concepts</a></li><li >
        <span onclick="leftNavClick(this)">HowTo</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/network-security/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/network-security/howto/services/" >Services</a></li><li ><a href="/vmcbook/guides/vmc-aws/network-security/howto/groups/" >Groups</a></li><li ><a href="/vmcbook/guides/vmc-aws/network-security/howto/gateway-firewall/" >Gateway Firewall</a></li><li ><a href="/vmcbook/guides/vmc-aws/network-security/howto/dfw/" >DFW</a></li><li ><a href="/vmcbook/guides/vmc-aws/network-security/howto/nat/" >NAT</a></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">Validated Designs</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/validated-designs/" >Index</a></li>
        <li >
        <span onclick="leftNavClick(this)">Network</span><ul class="sub-level indent">
        <li><a href="/vmcbook/guides/vmc-aws/validated-designs/network/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/validated-designs/network/hub-and-spoke-designs/" >Hub-and-Spoke Designs</a></li><li ><a href="/vmcbook/guides/vmc-aws/validated-designs/network/transit-gateway/" >Transit Gateway</a></li>
      </ul></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">Site</span><ul class="sub-level">
        <li><a href="/vmcbook/site/" >Index</a></li>
        <li ><a href="/vmcbook/site/authors/" >Authors</a></li><li ><a href="/vmcbook/site/authoring-guide/" >Authoring Guide</a></li><li ><a href="/vmcbook/site/information/" >Information</a></li><li ><a href="/vmcbook/site/links/" >Links</a></li><li ><a href="/vmcbook/site/editor/" >Markdown Editor</a></li><li ><a href="/vmcbook/site/resources/" >Resources</a></li>
      </ul></li></ul>
      </nav>

      <main class="main-content">  <div class="TableOfContents">
    <h1>Page Contents</h1>
    <nav id="TableOfContents">
<ul>
<li><a href="#introduction">Introduction</a>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#the-vmware-cloud-organization-org">The VMware Cloud Organization (Org)</a></li>
<li><a href="#amazon-web-services-account">Amazon Web Services Account</a></li>
<li><a href="#aws-regional-availability">AWS Regional Availability</a></li>
<li><a href="#software-defined-data-center-sddc">Software Defined Data Center (SDDC)</a></li>
<li><a href="#integration-with-aws-services">Integration with AWS Services</a></li>
</ul></li>
<li><a href="#compute">Compute</a>
<ul>
<li><a href="#permissions">Permissions</a></li>
<li><a href="#datacenters">Datacenters</a></li>
<li><a href="#clusters">Clusters</a></li>
<li><a href="#resource-pools">Resource Pools</a></li>
<li><a href="#edrs">EDRS</a></li>
</ul></li>
<li><a href="#storage">Storage</a>
<ul>
<li><a href="#datastores">Datastores</a></li>
<li><a href="#storage-policies">Storage Policies</a></li>
</ul></li>
<li><a href="#network">Network</a>
<ul>
<li><a href="#dns-and-dhcp">DNS and DHCP</a></li>
<li><a href="#ipsec-vpn">IPSec VPN</a></li>
<li><a href="#direct-connect">Direct Connect</a></li>
<li><a href="#ip-administration">IP Administration</a></li>
</ul></li>
<li><a href="#workload-on-boarding">Workload On-Boarding</a></li>
<li><a href="#operations">Operations</a>
<ul>
<li><a href="#log-intelligence">Log Intelligence</a></li>
<li><a href="#network-insight">Network Insight</a></li>
</ul></li>
</ul>
</nav>
  </div>

  
  <article class="content with-toc">
    <header class="content-header">
      <strong class="heading">VMware Cloud on AWS</strong><strong class="sub-heading">A Technical Overview</strong></header>

    

<h1 id="introduction">Introduction</h1>

<h2 id="overview">Overview</h2>

<p><a href="https://cloud.vmware.com/vmc-aws">VMware Cloud on AWS</a> is a managed cloud offering which provides dedicated VMware vSphere based Software Defined Data Centers (SDDC) which are hosted within <a href="https://aws.amazon.com/">AWS</a> facilities. Prior to getting started with the service, it is important to understand a few points.</p>

<ul>
<li>The service utilizes facilities and hardware which are owned and managed by AWS.</li>
<li>The service provides dedicated, private cloud environments in the form of an SDDC.</li>
<li>The hardware used for each SDDC is dedicated to that SDDC.</li>
<li>SDDCs are deployed within a VMware-owned AWS account and VMware manages billing for these resources.</li>
<li>SDDCs have high-speed access to AWS services hosted within a customer-owned AWS account.</li>
<li>Native AWS services are billed to the customer-owned AWS account and are not handled by VMware.</li>
</ul>

<p>Additionally, it is important to understand the <em>minimum</em> requirements for deploying an SDDC. These requirements are covered in detail in the <a href="https://dspinhirne.github.io/vmcbook/guides/vmc-aws/on-boarding/">On-Boarding</a> guide.</p>

<h2 id="the-vmware-cloud-organization-org">The VMware Cloud Organization (Org)</h2>

<p>The Org is the top-level &ldquo;container&rdquo; for all SDDCs. This topic is discussed in-depth in the document titled <a href="https://dspinhirne.github.io/vmcbook/guides/getting-started/introduction/#the-vmware-cloud-organization">Getting Started</a>.</p>

<h2 id="amazon-web-services-account">Amazon Web Services Account</h2>

<p>A major benefit of the service is its ability to provide direct access to AWS services. That said, it is required that all customers maintain a dedicated AWS account which will be used to access and manage these services.  If you are unsure of how to create an AWS account, then please refer to the <a href="https://aws.amazon.com/premiumsupport/knowledge-center/create-and-activate-account/">AWS documentation</a> for more information on the process.</p>

<p>A few important points on the AWS account:</p>

<ul>
<li>The account is necessary in order to provide an SDDC with access to AWS services.</li>
<li>It is required in order to deploy a production SDDC.</li>
<li>The account is owned by the customer, not by VMware.</li>
<li>Billing for the account is handled directly by AWS, not by VMware</li>
</ul>

<h2 id="aws-regional-availability">AWS Regional Availability</h2>

<p>VMware Cloud on AWS may not be available in your desired AWS region. Please refer to the <a href="https://cloud.vmware.com/vmc-aws/roadmap">roadmap</a> for a list of available regions.</p>

<h2 id="software-defined-data-center-sddc">Software Defined Data Center (SDDC)</h2>

<p>The Software Defined Data Center (SDDC) is a collection of bare-metal hosts which are installed with a standard set of VMware software. It is important to understand that each SDDC is running atop dedicated hardware, and that billing for an SDDC is based upon the number of hosts dedicated to the SDDC, and is <strong>not</strong> based on the number of VMs running within the SDDC.</p>

<figure   ><img src="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/resources/images/guides/vmc-aws/a-technical-overview/sddc.png" alt="Software Defined Data Center (SDDC)" /><figcaption>Software Defined Data Center (SDDC)</figcaption></figure>


<p>Since VMware Cloud On AWS is a managed service, full admin-level access to the SDDC is not permitted. This restriction is in place to prevent customers from modifying the infrastructure of the SDDC.  Instead, customers are given a role which allows them to fully manage workloads which they have deployed within the SDDC. Normally, this permissions model does not impact day-to-day use of the service, however, it&rsquo;s important to keep in mind if you are planning on integrating tools directly with infrastructure components such as vCenter. If the integration you are planning requires admin rights, then it may not function properly. It is recommended to review the documentation for your specific application in order to understand its permission and access requirements. The permissions model of vCenter is discussed in more detail in later sections.</p>

<section  class="callout" ><header>Key Takeaways</header><ul>
<li>An SDDC is deployed on dedicated, bare-metal hosts.</li>
<li>An SDDC is Deployed with standard components (ESXi, vCenter, NSX, vSAN).</li>
<li>Billing is based on the number of hosts within the SDDC, not on the number of VMs.</li>
<li>Users have the ability to manage their workloads but have limited access to vCenter,vSAN, and NSX.</li>
</ul>
</section>


<h2 id="integration-with-aws-services">Integration with AWS Services</h2>

<p>Each SDDC is provided direct access to AWS services via a connection to a customer-owned AWS account. This connection is established as part of the SDDC provisioning process and is performed using one of two methods:</p>

<ol>
<li>By choosing an AWS account which has already been connected as part of a previous SDDC deployment, or</li>
<li>By creating a new connection to an AWS account</li>
</ol>

<p>The term &ldquo;connected&rdquo; simply means that the customer has granted permissions for the VMware Cloud On AWS service to enable routing between an SDDC and a <a href="https://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/VPC_Subnets.html">VPC</a> within the customer-owned AWS account. These permissions are granted via <a href="https://aws.amazon.com/iam/">IAM</a> roles which are created within the connected account using a <a href="https://aws.amazon.com/cloudformation/">CloudFormation</a> template. It is important to note that the person who is performing the account connection process must have sufficient permissions (e.g. admin rights) within the AWS account in order to execute this CloudFormation template.</p>

<section  class="callout" ><header>Key Takeaways</header><ul>
<li>AWS services are managed through a customer-owned AWS account.</li>
<li>Account linking enables VMware Cloud services to cross-link SDDCs into a customer-owned AWS account.</li>
<li>Account linking is performed when the user executes a CloudFormation template within their AWS account.</li>
<li>The CloudFormation template creates roles which enable VMware to manage SDDC cross-linking.</li>
</ul>
</section>


<p>Once a connection is established to the AWS account, it then becomes possible to configure a cross-link between an SDDC and a VPC within that account. The cross-link itself consists of a series of Cross-Account <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html">ENI</a> which are attached to a Subnet within the VPC. It is these ENIs which provide the hosts of an SDDC with a network forwarding path to resources within the VPC.</p>

<figure   ><img src="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/resources/images/guides/vmc-aws/a-technical-overview/aws-service-integration.png" alt="Integration with AWS Services" /><figcaption>Integration with AWS Services</figcaption></figure>


<p>The topic of SDDC cross-linking will be explored in more detail in <a href="https://dspinhirne.github.io/vmcbook/guides/vmc-aws/networking/sddc-architecture/">later chapters</a>, but for now it is sufficient to keep the following in mind when selecting a VPC/Subnet for cross-linking:</p>

<ul>
<li>The VPC must exist within the same Region which is planned to house the SDDC.</li>
<li>The Subnet must be sufficiently large to accommodate one ENI per host within the SDDC. Typically, a /26 is the minimum recommended size for the Subnet. However, your deployment may require a larger subnet if you plan to grow beyond the 60 or so hosts supported by a /26 subnet.</li>
<li>Subnets are associated with an <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html">Availability Zone</a> (AZ), therefore the choice of Subnet determines the Availability Zone into which the SDDC is provisioned. The purpose of this is to avoid cross-AZ bandwidth charges between the SDDC and the Subnet used for cross-linking (see AWS <a href="https://aws.amazon.com/govcloud-us/pricing/data-transfer/">billing policies</a> for details).</li>
<li>It is recommended to use a dedicated Subnet for cross-linking. The purpose of this is to ensure that IP addresses within the Subnet are not consumed by other services (for example other EC2 instances) thus preventing ENIs for new hosts from being added as the SDDC grows. Secondary to that, using a dedicated Subnet helps prevent the situation where an AWS admin accidentally deletes or otherwise modifies the ENIs used for cross-linking.</li>
<li>It is possible to cross-link multiple SDDCs to the same VPC. If you plan to do this, then it is vital to ensure that you do not create IP addressing conflicts by using overlapping IP address ranges between the SDDCs. You should also avoid cross-linking multiple SDDCs to the same Subnet.</li>
</ul>

<h1 id="compute">Compute</h1>

<p>The compute resources of an SDDC are composed of a series of bare-metal servers, installed with ESXi, and managed by an instance of vCenter. The details of this configuration are below.</p>

<h2 id="permissions">Permissions</h2>

<p>Since SDDC version 1.7, permissions within vCenter are based on the Flexible vCenter Permissions Model. This model is designed to provide customers with the ability to manage objects within vCenter which they control, while preventing them from altering the management components of the SDDC.</p>

<p>As part of this model there exists a CloudAdmin role which has been assigned a Global Permission within vCenter. The role is a &ldquo;near Administrator&rdquo; in that it has been given permissions to the entire inventory tree of vCenter, but has been restricted to read-only permissions for management objects. A key function of this role is that it has the ability to create custom roles from a subset of its own privileges. These custom roles enable the administrator with more granular role-based access to vCenter objects, and in doing so, permit an SDDC to more closely resemble a traditional enterprise deployment of vCenter.</p>

<h2 id="datacenters">Datacenters</h2>

<p>vCenter is deployed with a single Datacenter under which all clusters/hosts are added.</p>

<h2 id="clusters">Clusters</h2>

<p>Each SDDC will start out with a single cluster, often referred to as the base or primary cluster, which is designed to house both management resources for the SDDC as well as customer compute resources. Additional clusters may be added to the SDDC as needed.</p>

<p>By default, all hosts of an SDDC are bound to a single AWS Availability Zone (AZ). For customers whose business needs require higher availability, there is the option to deploy an SDDC with multi-AZ support. Hosts within a multi-AZ SDDC will be split across (2) Availability Zones and the SDDC will be deployed with a special &ldquo;witness&rdquo; host in a 3rd AZ. Multi-AZ SDDCs are designed to provide a higher level of resiliency to the SDDC in the event of an AZ-level failure within AWS.</p>

<h2 id="resource-pools">Resource Pools</h2>

<p>Resource management within vCenter is enforced through the use of Resource Pools. Using this model, infrastructure-level appliances exist within a management Resource Pool while compute workloads are intended to exist within a compute Resource Pool. The CloudAdmin role does not have permissions to modify the management Resource Pool.</p>

<p>Due to the Flexible vCenter Permissions Model mentioned above, it is possible to create workloads outside of the compute Resource Pool. This practice is strongly discouraged due to the potential for creating resource contention between workloads which exist within Resource Pools and those that do not. As a general practice, all workloads should be placed within the compute Resource Pool in order to avoid this problem.</p>

<h2 id="edrs">EDRS</h2>

<p>Elastic Distributed Resource Scheduler (EDRS) is a feature which enables an SDDC to scale based on its average resource utilization. With EDRS, when utilization remains consistently above any of the scale-out thresholds, then the SDDC will automatically add hosts. Conversely, when utilization is consistently below any of the scale-in thresholds, then the SDDC will automatically remove hosts.</p>

<p>EDRS supports two modes of operation: optimized for cost, or optimized for performance. The difference between the two variants has to do with how aggressively a scale-in or scale-out action occurs. When optimized for cost, the SDDC will be more conservative when scaling-out but more eager to scale-in. When optimized for performance, the opposite is true.</p>

<h1 id="storage">Storage</h1>

<p>All storage within an SDDC is based upon vSAN. The details of this configuration are below.</p>

<h2 id="datastores">Datastores</h2>

<p>Within an SDDC, the vSAN cluster has been modified to present two logical Datastores: one for the management appliances and another for compute workloads. As with the management Resource Pool, the CloudAdmin role does not have access to the Datastore used by the management appliances.</p>

<figure   ><img src="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/resources/images/guides/vmc-aws/a-technical-overview/vcenter-ds.png" alt="vSAN Datastores" /><figcaption>vSAN Datastores</figcaption></figure>


<h2 id="storage-policies">Storage Policies</h2>

<p>Total usable storage within an SDDC is a function of a couple of variables. Firstly, the vSAN storage policy applied to VMs effects the amount of overhead required for data storage. Secondly, the ability of de-duplication &amp; compression to reduce the storage footprint plays a role.</p>

<p>Taking a look at the table below, we can see that each policy consists of a Failures to Tolerate (FTT) setting and a Fault Tolerance Method (FTM).</p>

<figure   ><table>
<thead>
<tr>
<th>FTT</th>
<th>FTM</th>
<th>Hosts Required</th>
<th>Required Capacity</th>
</tr>
</thead>

<tbody>
<tr>
<td>1</td>
<td>RAID1</td>
<td>3</td>
<td>2X</td>
</tr>

<tr>
<td>1</td>
<td>RAID5</td>
<td>4</td>
<td>1.33X</td>
</tr>

<tr>
<td>2</td>
<td>RAID1</td>
<td>4</td>
<td>3X</td>
</tr>

<tr>
<td>2</td>
<td>RAID6</td>
<td>6</td>
<td>1.5X</td>
</tr>

<tr>
<td>3</td>
<td>RAID1</td>
<td>7</td>
<td>4X</td>
</tr>
</tbody>
</table><figcaption>vSAN FTT/FTM Configurations</figcaption></figure>


<p>Each combination requires a certain minimum number of hosts and has an associated &ldquo;cost&rdquo; in terms of storage overhead required to implement. For example, we can see that the first policy in the table requires twice the storage space to implement the policy. This is because RAID1 mirroring is duplicated each storage object twice in order to implement the FTT value of 1. With vSAN, it is required to have a default storage policy and it is this policy which is used by VMs that do not have a storage policy explicitly defined on them.</p>

<p>It should be noted that EDRS will automatically add hosts to the SDDC when storage utilization crosses the 75% threshold. This practice is a preventative measure designed to ensure that vSAN has a minimal amount of &ldquo;slack&rdquo; space available to it at all times.</p>

<p>Finally, the <a href="http://vmcsizer.vmware.com/">VMC Sizer</a> tool has been made available as a means of assisting customers with estimating the number of hosts required to meet their storage demands.</p>

<h1 id="network">Network</h1>

<p>VMware utilizes <a href="https://docs.vmware.com/en/VMware-NSX-T/index.html">NSX-T</a> to build a logical overlay network on top of the hosts of the SDDC. There are 2 tiers of routing within the SDDC. At the top tier is the tier-0 edge router, which acts as the north-south gateway for the entire SDDC. Below that are the tier-1 routers (the MGW and CGW), which act as the north-south gateways for their respective networks.</p>

<p>There are 2 layers of firewalls in the SDDC. The first layers is provided by the gateway firewalls, which are designed to protect the north-south border of the SDDC. The gateway firewalls have a &ldquo;default deny&rdquo; policy and are implemented at the MGW (for the management network) and at the tier-0 edge (for the compute network). The second layer of firewalls are provided by the distributed firewall. The distributed firewall is enforced at the vNIC level of every VM within the compute network and is designed to enable filtering both north-south and east-west. The distributed firewall has a &ldquo;default permit&rdquo; policy which effectively disables the distributed firewall unless the SDDC administrator specifically creates &ldquo;deny&rdquo; rules.</p>

<p>The routing and network security models of the SDDC are illustrated below.</p>

<figure   ><img src="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/resources/images/guides/vmc-aws/a-technical-overview/sddc-networking.png" alt="SDDC Network Architecture" /><figcaption>SDDC Network Architecture</figcaption></figure>


<p>Additional details on the network and security model of the SDDC are covered in later chapters of this guide.</p>

<h2 id="dns-and-dhcp">DNS and DHCP</h2>

<p>DNS forwarding and caching services are provided to the SDDC via NSX. These services are implemented as a pair of DNS servers; one which serves the Management Network and another which serves the Compute Network. By default, these servers will forward requests to public DNS servers, however, users may configure custom DNS servers if so desired. For the Management Network, a single DNS server may be provided while for the Compute Network, multiple DNS servers may be specified (1 per DNS zone). It should be noted that DNS requests for the SDDC will appear to originate from the DNS service IPs. If custom DNS servers are configured within the SDDC, and these servers are protected by firewalls, then it will be important to ensure that the DNS service IPs are permitted through those firewalls.</p>

<p>NSX provides basic DHCP services to the Compute Network of the SDDC and these services are enabled on a per-segment basis at the time the segment is created. As part of the DHCP lease, clients will be provided the DNS service IP for the Compute Network as their DNS server.</p>

<h2 id="ipsec-vpn">IPSec VPN</h2>

<p>In the majority of setups, customers wish to maintain some sort of permanent means of direct connectivity between the SDDC and their on-premises environment. IPSec VPN is the most common means of accomplishing this. IPSec VPN provides secure connectivity to the private IP address ranges of the SDDC, and is implemented with a tunnel to the edge router.</p>

<p>IPSec VPN is detailed in <a href="https://dspinhirne.github.io/vmcbook/guides/vmc-aws/networking/ipsec-vpn/">later chapters</a> of this guide.</p>

<h2 id="direct-connect">Direct Connect</h2>

<p>For customers who want a high-speed private connection into their SDDC, VMware Cloud on AWS supports AWS <a href="https://docs.aws.amazon.com/directconnect/latest/UserGuide/Welcome.html">Direct Connect</a>. As with all AWS services, Direct Connect will be provisioned within the customer-owned AWS account. It is important to note that SDDCs may utilize <strong>existing</strong> Direct Connect services. There is no need to provision a dedicated Direct Connect for the SDDC. Utilizing a Direct Connect is the simple matter of provisioning a new <a href="https://docs.aws.amazon.com/directconnect/latest/UserGuide/WorkingWithVirtualInterfaces.html">Private VIF</a> and then allocated it to the VMware-owned AWS account which is associated to the parent Org of the SDDC. This account is visible from the Direct Connect interface of the SDDC within the <a href="https://vmc.vmware.com">VMC console</a>.</p>

<p>Direct Connect integration is detailed in <a href="https://dspinhirne.github.io/vmcbook/guides/vmc-aws/networking/direct-connect/">later chapters</a> of this guide.</p>

<h2 id="ip-administration">IP Administration</h2>

<p>All SDDCs will be cross-linked to a VPC within the customer-owned AWS account but may also be connected to other networks (such as an on-premises environment). In order to ensure that the SDDC can communicate with other interconnect networks, it is vital that IP addressing be properly planned. IP ranges should be unique and non-overlapping between the SDDC and any networks to which it will be connected. As such, one of the most critical pieces of the design process is proper planning of IP address usage.</p>

<p>Though not required, it is a good practice to allocate IP address space in large, contiguous chunks. The following table provides a sample IP Administration plan.</p>

<figure   ><table>
<thead>
<tr>
<th>Supernet</th>
<th>Subnet level-1</th>
<th>Subnet2 level-2</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>10.1.0.0/19</td>
<td></td>
<td></td>
<td>on-premises networks</td>
</tr>

<tr>
<td>10.1.32.0/19</td>
<td></td>
<td></td>
<td>AWS native</td>
</tr>

<tr>
<td>10.1.32.0/19</td>
<td>10.1.32.0/22</td>
<td></td>
<td>AWS Services VPC</td>
</tr>

<tr>
<td>10.1.32.0/19</td>
<td>10.1.32.0/22</td>
<td>10.1.32.0/26</td>
<td>AWS Services VPC SDDC x-link</td>
</tr>

<tr>
<td>10.1.64.0/19</td>
<td></td>
<td></td>
<td>SDDC1</td>
</tr>

<tr>
<td>10.1.64.0/19</td>
<td>10.1.64.0/20</td>
<td></td>
<td>SDDC1 Management</td>
</tr>

<tr>
<td>10.1.64.0/19</td>
<td>10.1.80.0/20</td>
<td></td>
<td>SDDC1 Compute</td>
</tr>

<tr>
<td>10.1.64.0/19</td>
<td>10.1.80.0/20</td>
<td>10.1.80.0/24</td>
<td>SDDC1 Compute Servers</td>
</tr>
</tbody>
</table><figcaption>An IP Administration Plan</figcaption></figure>


<h1 id="workload-on-boarding">Workload On-Boarding</h1>

<p>Customers will generally populate an SDDC with workloads in one of two ways:</p>

<ol>
<li>By building it out as a greenfield environment, or</li>
<li>By migrating existing workloads to it from another environment.</li>
</ol>

<p>A greenfield deployment operates on the notion that the SDDC is a completely new environment. In this scenarios, all workloads will be created from scratch and the environment will utilize freshly allocated IP address ranges.</p>

<p>The other scenario, workload migration, typically involves the notion of a data center evacuation.</p>

<p>Data center evacuation is common scenario in which an existing data center must be shut down and all workloads migrated into an SDDC. In addition to deadlines for the evacuation, there are often constraints in place which dictate how the migration may be performed. Requirements such as specifying that workloads retain their IP addresses or that migrations may only be performed during certain hours are common examples which complicate data center evacuations.</p>

<p>In order to address data center evacuation scenarios, VMware has developed a service called <a href="https://hcx.vmware.com">HCX</a> which enables transparent workload migration between sites. HCX has been specifically designed to address complex migration scenarios and includes features such as:</p>

<ul>
<li>Migration scheduling - enables migrations to be scheduled off-hours.</li>
<li>WAN optimization and data de-duplication - greatly reduces the time and network bandwidth required to perform migrations.</li>
<li><a href="https://en.wikipedia.org/wiki/Data_link_layer">Layer-2</a> network extension - enables workloads to migrate without requiring IP address changes.</li>
</ul>

<p>This service is discussed in detail within the <a href="https://dspinhirne.github.io/vmcbook/guides/hcx/">HCX</a> guide.</p>

<h1 id="operations">Operations</h1>

<p>A vital part of managing any deployment, whether on-premises or in the cloud, is to develop a proper strategy around operations. The following sections outline some of the supplemental tools which may be utilized within VMware Cloud on AWS to help flesh-out this strategy.</p>

<h2 id="log-intelligence">Log Intelligence</h2>

<p>Logging within VMware Cloud is provided via the <a href="https://cloud.vmware.com/log-intelligence">Log Intelligence</a> service.  This service is activated at the Org level within VMware Cloud and is offered in free as well as paid tiers.</p>

<p>The free tier offers users a means of searching visualizing audit logs (i.e. logs from the SDDC infrastructure) as well as a small amount of non-audit logs. When the service is initially activated, users will gain access to a 30-day free trial for the paid tier of the service. This paid tier offers features such as longer log retention, unlimited non-audit logging, long-term archival, alerting, and more. At the end of the 30-day trial, the service will drop down to the free tier unless users opt to continue with the paid tier.</p>

<h2 id="network-insight">Network Insight</h2>

<p>Understanding network flow patterns is useful for many reasons, including:</p>

<ul>
<li>Using flow data to map out application dependencies over a network.</li>
<li>Using flow data to assist in the development of network security policies.</li>
<li>Using flow data to help in understanding and monitoring network usage patterns.</li>
</ul>

<p><a href="https://cloud.vmware.com/network-insight-cloud">Network Insight</a> is a service which has been developed to provide analysis and alerting based on flow data exported from the SDDC as well as other metrics gathered from the vCenter API. Network Insight is not limited to monitoring the SDDC alone, and may also be used to gather and analyze data from a wide range of devices including those in the on-premises environment and in other points in the cloud environment.</p>

<p>As with Log Intelligence, Network Insight is available as part of a 30-day free trial.</p>
    
    <footer class="content-footer"><div>Written by<a href='https://dspinhirne.github.io/vmcbook/site/authors/#dustin-spinhirne'>Dustin Spinhirne</a></div><div>
          Originally publishedMonday, Aug 27, 2018.Updated onTuesday, Oct 1, 2019.</div></footer>

  </article></main>
    </article>
    
  </body>
</html>

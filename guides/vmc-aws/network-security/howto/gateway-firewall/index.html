<!DOCTYPE html>
<html>

<head>
  <title>VMware Cloud Knowledge</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="VMware Cloud articles and guides.">
  <meta name="generator" content="Hugo 0.62.2" />
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" href="https://dspinhirne.github.io/vmcbook/main.css">
  <script type="text/javascript" src="https://dspinhirne.github.io/vmcbook/main.js"></script>
</head>

  <body>
    
    <header class="main-header">
      <div>
        <a href="https://cloud.vmware.com"><img src="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/resources/images/vm.svg"></a>
      </div>
      <div><a href="https://dspinhirne.github.io/vmcbook/">VMware Cloud Knowledge</a></div>
      <div>
        <a href="https://github.com/dspinhirne/vmcbook" class="github-link"><img src="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/resources/images/github.svg"><span>Star</span></a>
      </div>
    </header>

    <article class="main-article">
      <nav class="left-nav">
        <ul class="top-level"><li >
        <span onclick="leftNavClick(this)">Getting Started</span><ul>
        <li><a href="/vmcbook/guides/getting-started/" >Index</a></li>
        <li ><a href="/vmcbook/guides/getting-started/introduction/" >Introduction</a></li><li >
        <span onclick="leftNavClick(this)">HowTo</span><ul>
        <li><a href="/vmcbook/guides/getting-started/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/getting-started/howto/activate-services/" >Activate Services</a></li><li ><a href="/vmcbook/guides/getting-started/howto/billing/" >Billing</a></li><li ><a href="/vmcbook/guides/getting-started/howto/manage-users/" >Manage Users</a></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">HCX</span><ul>
        <li><a href="/vmcbook/guides/hcx/" >Index</a></li>
        <li >
        <span onclick="leftNavClick(this)">A Technical Overview</span><ul>
        <li><a href="/vmcbook/guides/hcx/a-technical-overview/" >Index</a></li>
        <li ><a href="/vmcbook/guides/hcx/a-technical-overview/introduction/" >Introduction</a></li><li ><a href="/vmcbook/guides/hcx/a-technical-overview/planning/" >Planning</a></li><li ><a href="/vmcbook/guides/hcx/a-technical-overview/preparation/" >Preparation</a></li><li ><a href="/vmcbook/guides/hcx/a-technical-overview/testing/" >Testing</a></li><li ><a href="/vmcbook/guides/hcx/a-technical-overview/migration/" >Migration</a></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">HowTo</span><ul>
        <li><a href="/vmcbook/guides/hcx/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/hcx/howto/activate/" >Activate</a></li><li ><a href="/vmcbook/guides/hcx/howto/install/" >Install</a></li><li ><a href="/vmcbook/guides/hcx/howto/network-extension/" >Network Extension</a></li><li ><a href="/vmcbook/guides/hcx/howto/workload-migration/" >Workload Migration</a></li>
      </ul></li>
      </ul></li><li class="open parent">
        <span onclick="leftNavClick(this)">VMware Cloud on AWS</span><ul>
        <li><a href="/vmcbook/guides/vmc-aws/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/a-technical-overview/" >A Technical Overview</a></li><li >
        <span onclick="leftNavClick(this)">On-Boarding</span><ul>
        <li><a href="/vmcbook/guides/vmc-aws/on-boarding/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/on-boarding/introduction/" >Introduction</a></li><li ><a href="/vmcbook/guides/vmc-aws/on-boarding/requirements/" >Requirements</a></li><li >
        <span onclick="leftNavClick(this)">HowTo</span><ul>
        <li><a href="/vmcbook/guides/vmc-aws/on-boarding/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/on-boarding/howto/term-subscription/" >Term Subscription</a></li><li ><a href="/vmcbook/guides/vmc-aws/on-boarding/howto/sddc/" >SDDC</a></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">Networking</span><ul>
        <li><a href="/vmcbook/guides/vmc-aws/networking/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/networking/sddc-architecture/" >SDDC Architecture</a></li><li >
        <span onclick="leftNavClick(this)">IPSec VPN</span><ul>
        <li><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/concepts/" >Concepts</a></li><li >
        <span onclick="leftNavClick(this)">HowTo</span><ul>
        <li><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/configure/" >Configure</a></li><li ><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/troubleshoot/" >Troubleshoot</a></li><li ><a href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/sample-configs/" >Sample Configs</a></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">Direct Connect</span><ul>
        <li><a href="/vmcbook/guides/vmc-aws/networking/direct-connect/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/networking/direct-connect/concepts/" >Concepts</a></li><li >
        <span onclick="leftNavClick(this)">Index</span><ul>
        <li><a href="/vmcbook/guides/vmc-aws/networking/direct-connect/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/networking/direct-connect/howto/configure/" >Configure</a></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">HowTo</span><ul>
        <li><a href="/vmcbook/guides/vmc-aws/networking/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/networking/howto/network-segments/" >Network Segments</a></li>
      </ul></li>
      </ul></li><li class="open parent">
        <span onclick="leftNavClick(this)">Network Security</span><ul>
        <li><a href="/vmcbook/guides/vmc-aws/network-security/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/network-security/concepts/" >Concepts</a></li><li class="open parent">
        <span onclick="leftNavClick(this)">HowTo</span><ul>
        <li><a href="/vmcbook/guides/vmc-aws/network-security/howto/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/network-security/howto/services/" >Services</a></li><li ><a href="/vmcbook/guides/vmc-aws/network-security/howto/groups/" >Groups</a></li><li class="open parent"><a href="/vmcbook/guides/vmc-aws/network-security/howto/gateway-firewall/" class="active">Gateway Firewall</a></li><li ><a href="/vmcbook/guides/vmc-aws/network-security/howto/dfw/" >DFW</a></li><li ><a href="/vmcbook/guides/vmc-aws/network-security/howto/nat/" >NAT</a></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">Validated Designs</span><ul>
        <li><a href="/vmcbook/guides/vmc-aws/validated-designs/" >Index</a></li>
        <li >
        <span onclick="leftNavClick(this)">Network</span><ul>
        <li><a href="/vmcbook/guides/vmc-aws/validated-designs/network/" >Index</a></li>
        <li ><a href="/vmcbook/guides/vmc-aws/validated-designs/network/hub-and-spoke-designs/" >Hub-and-Spoke Designs</a></li><li ><a href="/vmcbook/guides/vmc-aws/validated-designs/network/transit-gateway/" >Transit Gateway</a></li>
      </ul></li>
      </ul></li>
      </ul></li><li >
        <span onclick="leftNavClick(this)">Site</span><ul>
        <li><a href="/vmcbook/site/" >Index</a></li>
        <li ><a href="/vmcbook/site/authors/" >Authors</a></li><li ><a href="/vmcbook/site/authoring-guide/" >Authoring Guide</a></li><li ><a href="/vmcbook/site/information/" >Information</a></li><li ><a href="/vmcbook/site/links/" >Links</a></li><li ><a href="/vmcbook/site/editor/" >Markdown Editor</a></li><li ><a href="/vmcbook/site/resources/" >Resources</a></li><li ><a href="/vmcbook/site/color-scheme/" >Color Scheme</a></li>
      </ul></li></ul>
      </nav>

      <main class="main-content">
  
  <article class="content ">
    <header class="content-header">
      <h1>VMware Cloud on AWS</h1><h2>Network Security HowTo: Gateway Firewall</h2></header>

    <h2 id="create-rules">Create Rules</h2>
<ol>
<li>Navigate to the Network &amp; Security tab of the SDDC within the VMC console.</li>
<li>Click on Gateway Firewall from the left-hand navigation, and choose either the Management Gateway or Compute Gateway ruleset.</li>
<li>Click on Add New Rule.</li>
<li>Provide the required fields for the new rule.</li>
<li>When finished adding rules, publish the ruleset.</li>
</ol>
<figure   ><img src="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/resources/images/guides/vmc-aws/network-security/howto/gateway-firewall/add-rule.png" alt="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/resources/images/guides/vmc-aws/network-security/howto/gateway-firewall/add-rule.png" /></figure>

<p>In the example, a rule is being created which will permit inbound HTTPS traffic to web servers. Let's examine the fields of the rule in detail.</p>
<ul>
<li>Name - A meaningful name for the new rule.</li>
<li>Source - The source of the request. In this example we are using the pre-defined value of Any which permits any source. We could have also chosen to use a custom defined group.</li>
<li>Destination - The destination for the request. In this example we are using a custom group which contains web servers.</li>
<li>Services - One or more services. In this example we are using a pre-created service for HTTPS.</li>
<li>Action - Allow the traffic or Drop the traffic.</li>
<li>Applied To - This field is unique to the Compute Gateway ruleset and will be explained later.</li>
<li>Logging - Enable or disable logging for matches on this rule. Logging may be useful for testing and troubleshooting.</li>
</ul>
<p>Keep in mind that there is no inherent direction for firewall rules. Since security policy is applied bidirectionally, direction is specified through the use of the source and destination fields.</p>
<p>Additional options for rules are available from the context menu of each rule.</p>
<figure   ><img src="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/resources/images/guides/vmc-aws/network-security/howto/gateway-firewall/rule-submenu.png" alt="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/resources/images/guides/vmc-aws/network-security/howto/gateway-firewall/rule-submenu.png" /></figure>

<p>Although it impacts security policy in a very critical way, the Applied To field and its purpose are not always well understood. Firstly, it is important to understand why this field is not available on the Management Gateway ruleset. Since the MGW has a single uplink (its uplink to the tier-0 edge), its ruleset is simply applied to that interface. Security policy for the compute network is a bit more complex, however. Since this policy is enforced on the tier-0 edge itself, and this edge has multiple uplinks, you must select where each individual rule is applied by setting the Applied To field of the rule. By default, the All Uplinks value is selected; however, other options are available.</p>
<figure   ><img src="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/resources/images/guides/vmc-aws/network-security/howto/gateway-firewall/applied-to.png" alt="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/resources/images/guides/vmc-aws/network-security/howto/gateway-firewall/applied-to.png" /></figure>

<p>It is important to understand these options:</p>
<ul>
<li>Internet Interface - As the name implies, this is the uplink to the AWS public network.</li>
<li>VPC Interface - This refers to the uplink for the cross-account ENI connection to the customer-owned AWS account.</li>
<li>Direct Connect Interface - When a Direct Connect has been attached to the SDDC, this is the uplink for the private VIF of that Direct Connect.</li>
<li>All Uplinks - A shorthand option for the Internet, VPC, and Direct Connect interfaces.</li>
<li>VPN Tunnel Interface - This option refers to VTI interfaces for any route-based VPNs which may have been created.</li>
</ul>
<p>The All Uplinks option is particularly important to call out since there tends to be some confusion around its meaning. All Uplinks refers to &ldquo;physical&rdquo; uplink interfaces of the tier-0 edge, which are outlined in more detail in the chapter on SDDC network architecture. What is not included as a physical uplink are Virtual Tunnel Interfaces (VTI) used by route-based VPNs. These interfaces are implemented in a very different way within NSX and are treated as a separate category of interface. When working with route-based VPN, the security administrator must remember to specifically apply policies to the VPN Tunnel Interface. Note the distinct callout for route-based VPN. This callout is intentional due to the fact that route-based VPNs are the only type of VPN to use VTI interfaces. Policy-based VPN relies on VPN policies which are applied to the physical uplinks of the tier-0 edge. In the case of policy-based VPN, rules applied to the uplinks would also apply to those VPNs. See the chapter on IPSec VPN for more information on the differences between route-based and policy-based VPN.</p>
<p>One last important consideration with rules applied to the VTI interfaces of route-based VPN has to do with the address space used by the VTIs themselves. It is a common practices to use the IPv4 link-local range (169.254.0.0/16) for point-to-point links such as VTI interfaces. As a convenience, this range has been whitelisted in the Compute Gateway ruleset in order to ensure that a BGP session may be established over the VPN. If you use address space for VTI interfaces which is outside of the link-local range, then you must remember to specifically permit control traffic such as BGP.</p>
    
    <footer class="content-footer"><div>
          Originally published Tuesday, Oct 1, 2019.
          Updated on Thursday, Jan 16, 2020.</div></footer>

  </article></main>
    </article>
    
  </body>
</html>
